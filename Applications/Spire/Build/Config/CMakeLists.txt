cmake_minimum_required(VERSION 2.8)
project(Spire)

include_directories(./../../Include)
include_directories($ENV{BEAM_INCLUDE_PATH})
include_directories($ENV{CPPUNIT_INCLUDE_PATH})
include_directories($ENV{NEXUS_INCLUDE_PATH})
include_directories($ENV{BOOST_INCLUDE_PATH})
include_directories($ENV{LUA_INCLUDE_PATH})
include_directories($ENV{ZLIB_INCLUDE_PATH})
include_directories($ENV{CRYPTOPP_INCLUDE_PATH})
include_directories($ENV{QT_INCLUDE_PATH})
include_directories($ENV{QT_CORE_INCLUDE_PATH})
include_directories($ENV{QT_GUI_INCLUDE_PATH})
include_directories($ENV{QT_WIDGETS_INCLUDE_PATH})
include_directories($ENV{OPEN_SSL_INCLUDE_PATH})
include_directories($ENV{TCLAP_INCLUDE_PATH})
include_directories($ENV{YAML_INCLUDE_PATH})

link_directories($ENV{BOOST_DEBUG_PATH})
link_directories($ENV{BOOST_OPTIMIZED_PATH})

SET(CMAKE_BUILD_TYPE $ENV{NEXUS_BUILD_TYPE})

if(UNIX)
  SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fPIC")
endif()

if(MSVC)
  set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /bigobj /WX")
  set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} /SAFESEH:NO")
  add_definitions(-DWIN32_LEAN_AND_MEAN)
  add_definitions(-DNOMINMAX)
  add_definitions(-D_WIN32_WINNT=0x0501)
  add_definitions(-D_SCL_SECURE_NO_WARNINGS)
  add_definitions(-D_CRT_SECURE_NO_DEPRECATE)
  add_definitions(-DQT_NO_KEYWORDS)
  add_definitions("/wd4355")
  add_definitions("/wd4503")
  add_definitions("/wd4091")
  add_definitions("/wd4297")
  add_definitions("/wd4005")
endif()
if(CMAKE_COMPILER_IS_GNUCC OR CMAKE_COMPILER_IS_GNUCXX OR
    "${CMAKE_CXX_COMPILER_ID}" STREQUAL "Clang")
  set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++1y")
  set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_RELEASE} -O2 -DNDEBUG")
endif()
if(CYGWIN)
  add_definitions(-D__USE_W32_SOCKETS)
endif()
if(${CMAKE_SYSTEM_NAME} STREQUAL SunOS)
  set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_RELEASE} -pthreads")
endif()

if(NOT EXISTS $ENV{INSTALL_DIRECTORY})
  file(MAKE_DIRECTORY $ENV{INSTALL_DIRECTORY})
endif()
if(NOT EXISTS $ENV{LIB_INSTALL_DIRECTORY}/Debug)
  file(MAKE_DIRECTORY $ENV{LIB_INSTALL_DIRECTORY}/Debug)
endif()
if(NOT EXISTS $ENV{LIB_INSTALL_DIRECTORY}/Release)
  file(MAKE_DIRECTORY $ENV{LIB_INSTALL_DIRECTORY}/Release)
endif()
if(NOT EXISTS $ENV{TEST_INSTALL_DIRECTORY}/Debug)
  file(MAKE_DIRECTORY $ENV{TEST_INSTALL_DIRECTORY}/Debug)
endif()
if(NOT EXISTS $ENV{TEST_INSTALL_DIRECTORY}/Release)
  file(MAKE_DIRECTORY $ENV{TEST_INSTALL_DIRECTORY}/Release)
endif()

macro(find_cpp_qobject output)
  foreach(_i ${ARGN})
    if(EXISTS ${_i})
      FILE(READ ${_i} _contents)
      STRING(REGEX MATCHALL "Q_OBJECT" _match "${_contents}")
      if(_match)
        SET(${output} ${${output}} ${_i})
      endif()
    endif()
  endforeach()
endmacro()

add_subdirectory(AccountViewer)
add_subdirectory(Blotter)
add_subdirectory(BookView)
add_subdirectory(Canvas)
add_subdirectory(CanvasView)
add_subdirectory(Catalog)
add_subdirectory(Charting)
add_subdirectory(Dashboard)
add_subdirectory(InputWidgets)
add_subdirectory(KeyBindings)
add_subdirectory(OrderImbalanceIndicator)
add_subdirectory(PortfolioViewer)
add_subdirectory(Resources)
add_subdirectory(RiskTimer)
add_subdirectory(Spire)
add_subdirectory(TimeAndSales)
add_subdirectory(UI)
add_subdirectory(Utilities)
